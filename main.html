<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <title>Inventario — Yair Inventario</title>
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <meta name="color-scheme" content="light dark" />
  <meta name="theme-color" content="#0b6cff" />  
  <link rel="stylesheet" href="style2.css">
</head>
<body>
<div class="app" id="app">
  <!-- inventario.html (sección dentro de tu página principal autenticada) -->

<section id="sec-inventario" class="inv-wrap">
  <div class="inv-toolbar">
    <input id="invSearch" class="inv-input" placeholder="Buscar PT, lote o código..." />
    <select id="invFiltro" class="inv-input">
      <option value="">Todo</option>
      <option value="sinStock">Sólo con stock</option>
      <option value="conEventos">Con ventas</option>
    </select>
  </div>

  <div class="inv-table-wrap">
    <table class="inv-table">
      <thead>
        <tr>
          <th>PT</th>
          <th>F. PT</th>
          <th>Recib.</th>
          <th>Vend.</th>
          <th>Disp.</th>
          <th>Ev.</th>
        </tr>
      </thead>
      <tbody id="invBody">
        <!-- Se llena por JS -->
      </tbody>
    </table>
  </div>
</section>

<!-- Modal para eventos (nivel 3) -->
<div id="modalEventos" class="inv-modal" hidden>
  <div class="inv-modal-backdrop"></div>
  <div class="inv-modal-card">
    <div class="inv-modal-header">
      <div>
        <div class="inv-modal-title">Eventos del lote</div>
        <div id="modalEventosSub" class="inv-modal-sub"></div>
      </div>
      <button id="modalEventosClose" class="inv-btn inv-btn-ghost">Cerrar</button>
    </div>
    <div id="modalEventosBody" class="inv-modal-body"></div>
  </div>
</div>

  <!-- ───────────── App ───────────── -->
  <div id="view-app">
    <header class="appbar">
      <div class="brand">Yair Inventario</div>
      <span id="envBadge" class="pill">Conectando…</span>
      <div class="spacer"></div>
      <span id="roleBadge" class="role-badge">—</span>
      <button id="logoutBtn" class="btn ghost">Salir</button>
    </header>

    <main class="content">
      <!-- 1) Inventario -->
      <section id="sec-inventario" class="grid" data-tab="inventario">
        <div class="card panel">
          <div class="searchbar">
            <input id="qInv" class="input" placeholder="Buscar por código, nombre o categoría…" />
            <select id="fCat" title="Categoría">
              <option value="">Todas</option>
              <option>Eléctrico</option>
              <option>RFID</option>
              <option>BLE</option>
              <option>Herramienta</option>
            </select>
            <button id="btnRefInv" class="btn">Refrescar</button>
          </div>
        </div>

        <div class="card panel" style="padding:0; overflow:auto; max-height:55vh">
          <table class="list" id="tblInv">
            <thead>
              <tr>
                <th>Código</th>
                <th>Descripción</th>
                <th>Stock</th>
                <th>UM</th>
                <th class="muted">Categoría</th>
              </tr>
            </thead>
            <tbody></tbody>
          </table>
        </div>
      </section>

      <!-- 2) Entradas -->
      <section id="sec-entradas" class="grid" data-tab="entradas">
        <div class="card panel grid cols-2">
          <div class="field">
            <label class="label">Código</label>
            <input id="enCod" class="input" placeholder="SKU / TAG" />
          </div>
          <div class="field">
            <label class="label">Cantidad</label>
            <input id="enQty" class="input" type="number" inputmode="decimal" placeholder="0" />
          </div>
          <div class="field">
            <label class="label">Proveedor</label>
            <input id="enProv" class="input" placeholder="Proveedor" />
          </div>
          <div class="field">
            <label class="label">Factura / Ref.</label>
            <input id="enRef" class="input" placeholder="Opcional" />
          </div>
          <div class="field" style="grid-column:1/-1">
            <label class="label">Notas</label>
            <textarea id="enNotas" rows="3" class="input" placeholder="Observaciones…"></textarea>
          </div>
          <div class="row" style="grid-column:1/-1; justify-content:flex-end">
            <button id="btnEntrada" class="btn primary">Registrar entrada</button>
          </div>
        </div>

        <div class="card panel">
          <div class="row" style="justify-content:space-between">
            <div class="muted">Últimas entradas</div>
            <button id="btnRefEnt" class="btn">Refrescar</button>
          </div>
          <div id="listaEntradas" class="grid" style="margin-top:.8rem"></div>
        </div>
      </section>

      <!-- 3) Salidas -->
      <section id="sec-salidas" class="grid" data-tab="salidas">
        <div class="card panel grid cols-2">
          <div class="field">
            <label class="label">Código</label>
            <input id="saCod" class="input" placeholder="SKU / TAG" />
          </div>
          <div class="field">
            <label class="label">Cantidad</label>
            <input id="saQty" class="input" type="number" inputmode="decimal" placeholder="0" />
          </div>
          <div class="field">
            <label class="label">Responsable</label>
            <input id="saResp" class="input" placeholder="Nombre" />
          </div>
          <div class="field">
            <label class="label">Destino / Proyecto</label>
            <input id="saDestino" class="input" placeholder="Proyecto / Cliente" />
          </div>
          <div class="field" style="grid-column:1/-1">
            <label class="label">Notas</label>
            <textarea id="saNotas" rows="3" class="input" placeholder="Observaciones…"></textarea>
          </div>
          <div class="row" style="grid-column:1/-1; justify-content:flex-end">
            <button id="btnSalida" class="btn primary">Registrar salida</button>
          </div>
        </div>

        <div class="card panel">
          <div class="row" style="justify-content:space-between">
            <div class="muted">Últimas salidas</div>
            <button id="btnRefSal" class="btn">Refrescar</button>
          </div>
          <div id="listaSalidas" class="grid" style="margin-top:.8rem"></div>
        </div>
      </section>

      <!-- 4) Solicitud de material -->
      <section id="sec-solicitud" class="grid" data-tab="solicitud">
        <div class="card panel grid cols-2">
          <div class="field">
            <label class="label">Solicitante</label>
            <input id="soNombre" class="input" placeholder="Tu nombre" />
          </div>
          <div class="field">
            <label class="label">Área/Proyecto</label>
            <input id="soArea" class="input" placeholder="Proyecto" />
          </div>
          <div class="field" style="grid-column:1/-1">
            <label class="label">Material (código o descripción)</label>
            <input id="soMat" class="input" placeholder="Ej. PN532, cable 18 AWG, etc." />
          </div>
          <div class="field">
            <label class="label">Cantidad</label>
            <input id="soQty" class="input" type="number" inputmode="decimal" placeholder="0" />
          </div>
          <div class="field">
            <label class="label">Urgencia</label>
            <select id="soUrg">
              <option>Normal</option>
              <option>Alta</option>
              <option>Crítica</option>
            </select>
          </div>
          <div class="field" style="grid-column:1/-1">
            <label class="label">Notas</label>
            <textarea id="soNotas" rows="3" class="input" placeholder="Detalles de uso, fechas, etc."></textarea>
          </div>
          <div class="row" style="grid-column:1/-1; justify-content:flex-end">
            <button id="btnSolicitar" class="btn primary">Enviar solicitud</button>
          </div>
        </div>

        <div class="card panel">
          <div class="row" style="justify-content:space-between">
            <div class="muted">Mis solicitudes</div>
            <button id="btnRefSol" class="btn">Refrescar</button>
          </div>
          <div id="listaSolicitudes" class="grid" style="margin-top:.8rem"></div>
        </div>
      </section>

      <!-- 5) Ajustes (SOLO ADMIN) -->
      <section id="sec-ajustes" class="grid" data-tab="ajustes" data-requires-role="admin">
        <div class="card panel">
          <div class="row" style="justify-content:space-between; align-items:center;">
            <div class="brand">Ajustes</div>
            <span class="pill">Sólo administrador</span>
          </div>
          <p class="muted">Configura endpoints, roles y opciones de inventario.</p>

          <div class="grid cols-2">
            <div class="field">
              <label class="label">Endpoint GAS (lectura)</label>
              <input id="stReadUrl" class="input" placeholder="https://script.google.com/.../exec?fn=read" />
            </div>
            <div class="field">
              <label class="label">Endpoint GAS (escritura)</label>
              <input id="stWriteUrl" class="input" placeholder="https://script.google.com/.../exec?fn=write" />
            </div>
            <div class="field">
              <label class="label">Nombre de almacén</label>
              <input id="stAlmacen" class="input" placeholder="Bodega principal" />
            </div>
            <div class="field">
              <label class="label">Unidad por defecto</label>
              <input id="stUM" class="input" placeholder="pz / m / kg / rollo" />
            </div>
            <div class="row" style="grid-column:1/-1; justify-content:flex-end">
              <button id="btnGuardarAjustes" class="btn primary" data-requires-role="admin">Guardar</button>
            </div>
          </div>
        </div>
      </section>

    </main>

    <!-- Tabs -->
    <nav class="tabs" role="tablist">
      <button class="tab active" data-go="inventario">Inventario</button>
      <button class="tab" data-go="entradas">Entradas</button>
      <button class="tab" data-go="salidas">Salidas</button>
      <button class="tab" data-go="solicitud">Solicitud</button>
      <button class="tab" data-go="ajustes" id="tab-ajustes" hidden>Ajustes</button>
    </nav>
  </div>

  <!-- Toast -->
  <div id="toast" class="toast"></div>
</div>


<!-- ──────────────────────────────────────────────────────────────
     Notas de implementación GAS (resumen rápido)
     1) Publica el Web App con permisos "Cualquiera con el enlace"
     2) Habilita CORS en doGet/doPost (e.g., Access-Control-Allow-Origin: *)
     3) Devuelve JSON según contrato (ok, token, role, user, items...)
     4) Valida el token en cada acción server-side (no confíes en el rol del cliente)
     5) Filtra por rol en el servidor las acciones restringidas
     6) Opcional: usa CacheService para lecturas (inventario) y LockService para concurrencia en entradas/salidas
     7) Considera registrar TAG_GRABADA, etc., según tu flujo ESP32
     ────────────────────────────────────────────────────────────── -->
     <!--<script src="postLoginY.js"></script> -->
     <script src="inventario.js"></script>
</html>
